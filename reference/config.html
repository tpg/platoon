<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.67">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>Config Reference | Platoon</title><meta name="description" content="Platoon configuration file reference">
    <link rel="preload" href="/platoon/assets/style-360339f8.css" as="style"><link rel="stylesheet" href="/platoon/assets/style-360339f8.css">
    <link rel="modulepreload" href="/platoon/assets/app-e92ff216.js"><link rel="modulepreload" href="/platoon/assets/config.html-d65cdb7d.js"><link rel="modulepreload" href="/platoon/assets/config.html-0f9526af.js"><link rel="prefetch" href="/platoon/assets/index.html-a39802f3.js" as="script"><link rel="prefetch" href="/platoon/assets/getting_started.html-ad886aa7.js" as="script"><link rel="prefetch" href="/platoon/assets/releases.html-8edaf1c7.js" as="script"><link rel="prefetch" href="/platoon/assets/envoy.html-228e35fe.js" as="script"><link rel="prefetch" href="/platoon/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/platoon/assets/index.html-b9ad0b7b.js" as="script"><link rel="prefetch" href="/platoon/assets/getting_started.html-47388609.js" as="script"><link rel="prefetch" href="/platoon/assets/releases.html-d091b23f.js" as="script"><link rel="prefetch" href="/platoon/assets/envoy.html-5e80846f.js" as="script"><link rel="prefetch" href="/platoon/assets/404.html-7b853bee.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/platoon/" class=""><!----><span class="site-name">Platoon</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/platoon/guide/getting_started.md" class="" aria-label="Guide"><!--[--><!--]--> Guide <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Reference"><span class="title">Reference</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Reference"><span class="title">Reference</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/platoon/reference/config.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Config Reference"><!--[--><!--]--> Config Reference <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/platoon/reference/envoy.html" class="" aria-label="Envoy Reference"><!--[--><!--]--> Envoy Reference <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/thepublicgood/platoon" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/platoon/guide/getting_started.md" class="" aria-label="Guide"><!--[--><!--]--> Guide <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Reference"><span class="title">Reference</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Reference"><span class="title">Reference</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/platoon/reference/config.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Config Reference"><!--[--><!--]--> Config Reference <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/platoon/reference/envoy.html" class="" aria-label="Envoy Reference"><!--[--><!--]--> Envoy Reference <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/thepublicgood/platoon" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">Reference <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/platoon/reference/config.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Config Reference"><!--[--><!--]--> Config Reference <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/platoon/reference/config.html#targets" class="router-link-active router-link-exact-active sidebar-item" aria-label="Targets"><!--[--><!--]--> Targets <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/platoon/reference/config.html#extra-options" class="router-link-active router-link-exact-active sidebar-item" aria-label="Extra options"><!--[--><!--]--> Extra options <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/platoon/reference/config.html#directory-structure" class="router-link-active router-link-exact-active sidebar-item" aria-label="Directory structure"><!--[--><!--]--> Directory structure <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/platoon/reference/config.html#default-target" class="router-link-active router-link-exact-active sidebar-item" aria-label="Default target"><!--[--><!--]--> Default target <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/platoon/reference/config.html#common-target-settings" class="router-link-active router-link-exact-active sidebar-item" aria-label="Common target settings"><!--[--><!--]--> Common target settings <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/platoon/reference/config.html#assets" class="router-link-active router-link-exact-active sidebar-item" aria-label="Assets"><!--[--><!--]--> Assets <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/platoon/reference/config.html#cleaning-up" class="router-link-active router-link-exact-active sidebar-item" aria-label="Cleaning up"><!--[--><!--]--> Cleaning up <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/platoon/reference/config.html#hooks" class="router-link-active router-link-exact-active sidebar-item" aria-label="Hooks"><!--[--><!--]--> Hooks <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/platoon/reference/envoy.html" class="sidebar-item" aria-label="Envoy Reference"><!--[--><!--]--> Envoy Reference <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="configuration-reference" tabindex="-1"><a class="header-anchor" href="#configuration-reference" aria-hidden="true">#</a> Configuration Reference</h1><p>The Platoon configuration is simple, and since it&#39;s a normal Laravel config file (which is really just a PHP file that returns an array), Laravel developers should feel right at home. The Platoon config is in the <code>platoon.php</code> file in your config directory. If it&#39;s not there, run the <code>platoon:publish</code> Artisan command.</p><p>The config file houses all deployment information for the current project and in most cases you&#39;ll want to commit the file to your repo. Platoon does not support password authentication, so you should not be including any sensitive authentication information in the config file.</p><h2 id="targets" tabindex="-1"><a class="header-anchor" href="#targets" aria-hidden="true">#</a> Targets</h2><p>Targets are the hosts where your project will be deployed to. You can have as many targets as you need, but you must have at least one. A typical target configuration looks something like this:</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token string single-quoted-string">&#39;targets&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">&#39;staging&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">&#39;host&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;staging.test&#39;</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;port&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">22</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;username&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;ssh-username&#39;</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;root&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;/path/to/application/root&#39;</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;php&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;/usr/bin/php&#39;</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;composer&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;/path/to/composer.phar&#39;</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;branch&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;master&#39;</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;migrate&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>staging</code> key is the name of the target. You&#39;ll use this name to reference this target when deploying. The only required options are <code>host</code>, <code>username</code> and <code>root</code>. All the others have default values. There are also <code>assets</code> and <code>hooks</code> settings that are not required. You can find out more about them under the <a href="#assets">Assets</a> and <a href="#hooks">Hooks</a> sections.</p><div class="custom-container tip"><p class="custom-container-title">Note</p><p>Platoon does not support password authentication. Your targets MUST be accessible using SSH keys. This means you&#39;ll need to generate a local key pair and copy the public key to the server.</p></div><table><thead><tr><th>Target setting</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>host</code></td><td>-</td><td>The hostname or IP address of the remote target</td></tr><tr><td><code>port</code></td><td>22</td><td>The SSH port number</td></tr><tr><td><code>username</code></td><td>-</td><td>The SSH username</td></tr><tr><td><code>root</code></td><td>-</td><td>The path to the project root</td></tr><tr><td><code>php</code></td><td><code>/usr/bin/php</code></td><td>The full path to the PHP binary</td></tr><tr><td><code>composer</code></td><td><code>&lt;project-root&gt;/composer.phar</code></td><td>The full path to where composer.phar is stored. Defaults to the project root.</td></tr><tr><td><code>branch</code></td><td><code>main</code></td><td>The branch to clone</td></tr><tr><td><code>migrate</code></td><td><code>false</code></td><td>Migrate database changes on the target</td></tr><tr><td><code>assets</code></td><td><code>[]</code></td><td>Assets to copy during deployment. See <a href="#assets">Assets</a></td></tr><tr><td><code>hooks</code></td><td><code>[]</code></td><td>The hooks to run. See <a href="#hooks">Hooks</a></td></tr><tr><td><code>paths</code></td><td><code>[]</code></td><td>Any changes to directory structure. See <a href="#directory-structure">Directory Structure</a></td></tr></tbody></table><h3 id="extra-options" tabindex="-1"><a class="header-anchor" href="#extra-options" aria-hidden="true">#</a> Extra options</h3><p>It&#39;s also possible to include a few additional options to the target config. At the moment, the option extra option supported is <code>composer-flags</code>. When running Composer, Platoon will use the following:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">composer</span> <span class="token function">install</span> --prefer-dist --no-dev --no-progress -optimize-autoloader
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>In addition, the <code>-dallow_url_fopen=1</code> option is always passed to the PHP executable.</p><p>If you ever needed to add additional flags to the Composer or PHP CLI, you can use the <code>extra.composer-flags</code> and <code>extra.php-flags</code> options:</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">&#39;targets&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">&#39;dev&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
            <span class="token comment">// ...</span>
            <span class="token string single-quoted-string">&#39;extra&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                <span class="token string single-quoted-string">&#39;composer-flags&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                    <span class="token string single-quoted-string">&#39;--dev&#39;</span><span class="token punctuation">,</span>
                    <span class="token string single-quoted-string">&#39;--optimize-autoloader&#39;</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">&#39;php-flags&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                    <span class="token string single-quoted-string">&#39;-dmemory_limit=512M&#39;</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">Note</p><p>The <code>--no-progress</code> flag is always passed to Composer, and the <code>-dallow_url_fopen=1</code> option is always set on the PHP CLI.</p></div><h2 id="directory-structure" tabindex="-1"><a class="header-anchor" href="#directory-structure" aria-hidden="true">#</a> Directory structure</h2><p>The <code>path</code> setting refers to the ROOT directory where the project is stored. In this root directory, Platoon will place all the bits needed for your project. By default there is a <code>releases</code> directory, a <code>storage</code> directory, a <code>.env</code> file and a symbolic link named <code>live</code>. During deployment, Platoon will create symbolic links for the <code>.env</code> file and <code>storage</code> directory into a new directory created in <code>releases</code>. A typical project directory structure looks something like this:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/path/to/project/
    |
    +- .env
    |
    +- live/  --&gt; /path/to/project/releases/202201010000
    |
    +- releases/
    |   |
    |   +- 202201010000/
    |       |
    |       +- .env  --&gt; /path/to/project/.env
    |       |
    |       +- storate/  --&gt; /path/to/project/storage/
    |
    +- storage/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If you need to make changes to the <code>.env</code> file or the contents of the <code>storage</code> directory, you do so in the project root. This is the magic behind the zero-downtime deployment.</p><p>You can change the names of the directories that Platoon will create. In most cases, you should leave these settings alone, but if the need arises, you can pass an array to the <code>paths</code> config in your <code>platoon.php</code> target config:</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token string single-quoted-string">&#39;targets&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">&#39;staging&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token comment">//...</span>
        <span class="token string single-quoted-string">&#39;paths&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">&#39;releases&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;deployments&#39;</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;live&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;serve&#39;</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;storage&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;stuff&#39;</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;.env&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;config&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>Path Config</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>releases</code></td><td><code>releases</code></td><td>The directory where new releases are deployed</td></tr><tr><td><code>live</code></td><td><code>live</code></td><td>The name of the symbolic link that the web server should serve</td></tr><tr><td><code>storage</code></td><td><code>storage</code></td><td>The name of the Laravel storage directory</td></tr><tr><td><code>.env</code></td><td><code>.env</code></td><td>The name of the laravel <code>.env</code> file</td></tr></tbody></table><p>Note that the <code>.env</code> and <code>storage</code> paths will always be named correctly when symlinked into the release. These settings allow you to change the name of the paths that Platoon will create.</p><h2 id="default-target" tabindex="-1"><a class="header-anchor" href="#default-target" aria-hidden="true">#</a> Default target</h2><p>Since it may be common to have more than one target, it&#39;s handy to have one of them set as the default. You can do this by supplying the name of one of the targets to the <code>default</code> config setting. Platoon will then use this target without you needing to specify it when deploying. If you don&#39;t specify a default in the config, then Platoon will assume that the first target specified is the default.</p><p>You can disable the default target completely by setting the <code>default</code> option to <code>false</code>. This can be useful if you are worried about deploying to the wrong host. Without a default, you&#39;re forced to make a choice about which target to deploy to.</p><h2 id="common-target-settings" tabindex="-1"><a class="header-anchor" href="#common-target-settings" aria-hidden="true">#</a> Common target settings</h2><p>There are situations where your targets might actually be the same phyiscal server. In this case, you can set up a <code>common</code> target and provide details that can be used across all the targets you specify. Anything you set for any particular target will then overwrite the common settings. To create a common target, simply name it <code>common</code>. You can provide any target setting to the common target and it will be the default set for all your other targets.</p><p>For example, you might want to set a common hostname, username and port number:</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">&#39;targets&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">&#39;common&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">&#39;host&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;common.host&#39;</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;port&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">22</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;username&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;user&#39;</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;php&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;/usr/bin/php&#39;</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;composer&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;/path/to/composer.phar&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;staging&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">&#39;path&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;/opt/app/staging&#39;</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;migrate&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;branch&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;develop&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;production&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">&#39;path&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;/opt/app/production&#39;</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;migrate&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;branch&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;main&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="assets" tabindex="-1"><a class="header-anchor" href="#assets" aria-hidden="true">#</a> Assets</h2><p>It&#39;s strongly recommended that you never place compiled assets in your projects Git repository. It just makes things messy. Instead, assets should be compiled either on the target, or compiled and copied to the target during deployment. The latter is a common approach when dealing with a CI/CD pipeline. You can specify a list of assets to copy using the <code>assets</code> array on your target. You can also specify <code>assets</code> on the common target and it will be used for all other targets automatically.</p><p>The <code>assets</code> array is a key value pair. The key being the local file, and the value being the remote file.</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token string single-quoted-string">&#39;staging&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token comment">//...</span>
    <span class="token string single-quoted-string">&#39;assets&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">&#39;public/js/app.js&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;public/js/app.js&#39;</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;public/css/app.css&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;public/css/app.css&#39;</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;public/images/*&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;public/images&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">Take Note</p><p>When specifying whole directories, take note that if you specify a directory that already exists, the assets will be copied to a new directory INSIDE the directory you specified. This is likely NOT what you want and can be annoying to debug.</p><p>Directories are always copied recursively, so you don&#39;t need to specify any child paths.</p></div><h2 id="cleaning-up" tabindex="-1"><a class="header-anchor" href="#cleaning-up" aria-hidden="true">#</a> Cleaning up</h2><p>One of the final tasks that Platoon will complete is to clean up any old releases on the target. By default the current release and the previous one are left untouched and all other releases are removed. This will allow you to backtrack to a previous release if changes you make cause problems after deployment.</p><h2 id="hooks" tabindex="-1"><a class="header-anchor" href="#hooks" aria-hidden="true">#</a> Hooks</h2><p>Hooks are a simple way to add functionality to each task without needing to modify the Envoy script. This is handly if, for example. you need to provide your own build steps before deploying. Each step has a post hook, which means that scripts are executed AFTER the default scripts. There are currently 10 tasks. You can add hooks per target or to the common target config. Hooks must exist inside the <code>hooks</code> array and must be an array of bash commands:</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token string single-quoted-string">&#39;targets&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">&#39;staging&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token comment">//...</span>
        <span class="token string single-quoted-string">&#39;hooks&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">&#39;build&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                <span class="token string single-quoted-string">&#39;yarn production&#39;</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;finish&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                <span class="token string single-quoted-string">&#39;php ./artisan horizon:terminate&#39;</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>With the exception of <code>build</code> and <code>assets</code>, all tasks are run on the remote server. The following hooks are available:</p><table><thead><tr><th>Hook</th><th>Where</th><th>Description</th></tr></thead><tbody><tr><td><code>build</code></td><td>local</td><td>Use it to run any tasks BEFORE starting the deployment</td></tr><tr><td><code>install</code></td><td>remote</td><td>After the repository is cloned into a new release directory</td></tr><tr><td><code>prep</code></td><td>remote</td><td>After the symbolic links to <code>.env</code> and <code>storage</code> are created in the project root</td></tr><tr><td><code>composer</code></td><td>remote</td><td>Run after the Composer executable is downloaded or updated</td></tr><tr><td><code>dependencies</code></td><td>remote</td><td>After Composer dependencies have been installed</td></tr><tr><td><code>assets</code></td><td>local</td><td>After the specified assets have been copied to the remote</td></tr><tr><td><code>database</code></td><td>remote</td><td>After any database changes have been run</td></tr><tr><td><code>live</code></td><td>remote</td><td>After the <code>live</code> symbolic link is created, effective making the project live.</td></tr><tr><td><code>cleanup</code></td><td>remote</td><td>After any old releases have been removed</td></tr><tr><td><code>finish</code></td><td>remote</td><td>Use this to run any final deployment tasks</td></tr></tbody></table><p>All hooks run on the remote target are executed within the project root path.</p><p>Platoon hooks also include a set of expansion tags that can make writing hooks a whole lot easier. For example, you can reference the configured PHP executable by using the <code>@php</code> tag. This means, you could write the previous <code>finish</code> hook like this:</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token string single-quoted-string">&#39;finish&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">&#39;@php ./artisan horizon:terminate&#39;</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>However, there is also a <code>@artisan</code> tag which will basically do that same thing inside the release directory:</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token string single-quoted-string">&#39;finish&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">&#39;@artisan horizon:terminate&#39;</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This way you never have to worry about having the correct paths.</p><p>The following tags are provided:</p><table><thead><tr><th>Tag</th><th>Expansion</th></tr></thead><tbody><tr><td><code>@php</code></td><td>The full path to the configured PHP binary</td></tr><tr><td><code>@artisan</code></td><td>The full path to the artisan script prefixed with the configured PHP binary</td></tr><tr><td><code>@composer</code></td><td>The path to the configured composer phar</td></tr><tr><td><code>@base</code></td><td>The project base directory</td></tr><tr><td><code>@release</code></td><td>The ID of the release currently being deployed</td></tr><tr><td><code>@install</code></td><td>The path to the current release directory. Same as using <code>@base/releases/@release</code></td></tr></tbody></table><div class="custom-container warning"><p class="custom-container-title">Warning</p><p>Hooks defined for targets are NOT merged with the common target config. If you define a common hook, and then define the same hook on a target, the target&#39;s hook config will override the common config. For this reason, it is recommended that you don&#39;t define hooks under <code>common</code> unless you have good reason to do so.</p></div></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/thepublicgood/platoon/edit/main/reference/config.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: me@warrickbayman.com">Warrick Bayman</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: me@warrickbayman.com">Warrick</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><!----><span class="next"><a href="/platoon/reference/envoy.html" class="" aria-label="Envoy Reference"><!--[--><!--]--> Envoy Reference <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/platoon/assets/app-e92ff216.js" defer></script>
  </body>
</html>
